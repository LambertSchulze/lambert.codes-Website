<!DOCTYPE html><html><head><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><title>Hosting a static Next.js site on GitHub Pages</title><meta name="next-head-count" content="3"/><link rel="preload" href="/lambert.codes-Website/_next/static/css/619856c65dcd85aa37b7.css" as="style"/><link rel="stylesheet" href="/lambert.codes-Website/_next/static/css/619856c65dcd85aa37b7.css" data-n-g=""/><noscript data-n-css=""></noscript><link rel="preload" href="/lambert.codes-Website/_next/static/chunks/webpack-50bee04d1dc61f8adf5b.js" as="script"/><link rel="preload" href="/lambert.codes-Website/_next/static/chunks/framework.0a9f20eff0752717cd72.js" as="script"/><link rel="preload" href="/lambert.codes-Website/_next/static/chunks/commons.ee65f231e79a9a0fddaf.js" as="script"/><link rel="preload" href="/lambert.codes-Website/_next/static/chunks/main-5dfe3e88bbc030d62d41.js" as="script"/><link rel="preload" href="/lambert.codes-Website/_next/static/chunks/pages/_app-bf675666c14c1a780ca1.js" as="script"/><link rel="preload" href="/lambert.codes-Website/_next/static/chunks/7989c093b81d86ddb0abfb342d5bc2e84730435d.12ba32d70d70a300b14f.js" as="script"/><link rel="preload" href="/lambert.codes-Website/_next/static/chunks/pages/posts/%5Bid%5D-d2fc321675bd0eea2cef.js" as="script"/></head><body><div id="__next"><article><h1>Hosting a static Next.js site on GitHub Pages</h1><div><time dateTime="2021-04-16">April 16, 2021</time></div><div><p>Instead of using Vercel or Netlify I wanted to try out hosting my site on GitHub Pages.
Since it's a fully static site right now (it only uses <code>gitStaticProps</code> and <code>getStaticPaths</code>)
this should be possible.</p>
<p>Following this <a href="https://blog.sallai.me/deploy-next-site-to-github-pages">great article</a> I got it
up and running with just a few steps:</p>
<h2>Updating the build script</h2>
<p>Change the <strong>build script</strong> in your <code>package.json</code> file to</p>
<pre><code>"scripts": {
  "build": "next build &#x26;&#x26; next export"
}
</code></pre>
<p>The output told me that <code>next export</code> isn't necessary. I didn't test it yet, but maybe <code>next build</code>
is all that is needed.</p>
<p>The build command creates the folders <code>.next</code> and <code>out</code>. You don't have to commit these folders to
the main branch because we want a GitHub Action to build and commit these folders automatically to
a <code>gh-pages</code> branch.</p>
<p>Add these folders to the <code>.gitignore</code> if you created these folders on your local machine.</p>
<h2>Setting up the GitHub Action</h2>
<p>The first step is to generate a <strong>personal access token</strong> for the action to be able to commit and push.</p>
<p>Go to <em>GitHub Settings</em> -> <em>Developer settings</em> -> <em>Personal access tokens</em> and generate a new token
with <strong>repo</strong> scope.</p>
<p>With this token go to the repository and under <em>Settings</em> -> <em>Secrets</em> create a new secret named
<code>ACCESS_TOKEN</code>.</p>
<p>To create a GitHub Action you need a directory in your repository called <code>.github/workflows</code>. In
that folder create a <code>.yaml</code> file with the following contents:</p>
<pre><code>name: Build and Deploy
on:
  push:
    branches:
      - main
jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v2.3.1
        with:
          persist-credentials: false

      - name: Build
        run: |
          npm ci
          npm run build

      - name: Deploy
        uses: JamesIves/github-pages-deploy-action@3.6.1
        with:
          GITHUB_TOKEN: ${{ secrets.ACCESS_TOKEN }}
          BRANCH: gh-pages
          FOLDER: out
          CLEAN: true
</code></pre>
<p>On each push to the <code>main</code> branch the action runs <code>npm run build</code> and pushes the folder <code>out</code> to
the <code>gh-pages</code> branch using our token <code>secrets.ACCESS_TOKEN</code>.</p>
<h2>Enable GitHub Pages</h2>
<p>Make shure that GitHub Pages is active in your repository. In your repository go to <em>Settings</em> ->
<em>Pages</em> and <code>gh-pages</code> is the source for the page.</p>
<p>Because GitHub uses <strong>Jekyll</strong> under the hood to host and render sites, this could create some problems. To disable Jekyll, create an empty file in the <code>gh-pages</code> branch called <code>.nojekyll</code>.
Because of the <code>CLEAN</code> property our GitHub Action, this file will not be deleted.</p>
<h2>Update root level in Next.js</h2>
<p>Next.js assumes that the site is under the root level of your domain. But with GitHub Pages it will
be served under <code>username.github.io/repository</code>.</p>
<p>We can change the base path in <code>next.config.js</code> depending if we're developing locally or building
for production:</p>
<pre><code>const basePath = process.env.NODE_ENV === 'production' ? '/repo' : '';

module.exports = {
  basePath,
  assetPrefix: `${basePath}/`
};
</code></pre>
<p><code>basePath</code> specifies the root for <code>&#x3C;Link></code> components, <code>assetPrefix</code> the root for all assets.</p>
<h2>Troubleshooting</h2>
<p>I get an error during the build process stating that the command <code>::set-env name=DEPLOYMENT_STATUS::success</code> can't be run. It seems to work nevertheless, but I'll give an update
as soon as I've fixed the issue.</p>
</div></article><a href="/lambert.codes-Website">back to Home</a></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"postData":{"id":"nextjs-static-site-on-gh-pages","contentHtml":"\u003cp\u003eInstead of using Vercel or Netlify I wanted to try out hosting my site on GitHub Pages.\nSince it's a fully static site right now (it only uses \u003ccode\u003egitStaticProps\u003c/code\u003e and \u003ccode\u003egetStaticPaths\u003c/code\u003e)\nthis should be possible.\u003c/p\u003e\n\u003cp\u003eFollowing this \u003ca href=\"https://blog.sallai.me/deploy-next-site-to-github-pages\"\u003egreat article\u003c/a\u003e I got it\nup and running with just a few steps:\u003c/p\u003e\n\u003ch2\u003eUpdating the build script\u003c/h2\u003e\n\u003cp\u003eChange the \u003cstrong\u003ebuild script\u003c/strong\u003e in your \u003ccode\u003epackage.json\u003c/code\u003e file to\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e\"scripts\": {\n  \"build\": \"next build \u0026#x26;\u0026#x26; next export\"\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThe output told me that \u003ccode\u003enext export\u003c/code\u003e isn't necessary. I didn't test it yet, but maybe \u003ccode\u003enext build\u003c/code\u003e\nis all that is needed.\u003c/p\u003e\n\u003cp\u003eThe build command creates the folders \u003ccode\u003e.next\u003c/code\u003e and \u003ccode\u003eout\u003c/code\u003e. You don't have to commit these folders to\nthe main branch because we want a GitHub Action to build and commit these folders automatically to\na \u003ccode\u003egh-pages\u003c/code\u003e branch.\u003c/p\u003e\n\u003cp\u003eAdd these folders to the \u003ccode\u003e.gitignore\u003c/code\u003e if you created these folders on your local machine.\u003c/p\u003e\n\u003ch2\u003eSetting up the GitHub Action\u003c/h2\u003e\n\u003cp\u003eThe first step is to generate a \u003cstrong\u003epersonal access token\u003c/strong\u003e for the action to be able to commit and push.\u003c/p\u003e\n\u003cp\u003eGo to \u003cem\u003eGitHub Settings\u003c/em\u003e -\u003e \u003cem\u003eDeveloper settings\u003c/em\u003e -\u003e \u003cem\u003ePersonal access tokens\u003c/em\u003e and generate a new token\nwith \u003cstrong\u003erepo\u003c/strong\u003e scope.\u003c/p\u003e\n\u003cp\u003eWith this token go to the repository and under \u003cem\u003eSettings\u003c/em\u003e -\u003e \u003cem\u003eSecrets\u003c/em\u003e create a new secret named\n\u003ccode\u003eACCESS_TOKEN\u003c/code\u003e.\u003c/p\u003e\n\u003cp\u003eTo create a GitHub Action you need a directory in your repository called \u003ccode\u003e.github/workflows\u003c/code\u003e. In\nthat folder create a \u003ccode\u003e.yaml\u003c/code\u003e file with the following contents:\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003ename: Build and Deploy\non:\n  push:\n    branches:\n      - main\njobs:\n  build-and-deploy:\n    runs-on: ubuntu-latest\n    steps:\n      - name: Checkout\n        uses: actions/checkout@v2.3.1\n        with:\n          persist-credentials: false\n\n      - name: Build\n        run: |\n          npm ci\n          npm run build\n\n      - name: Deploy\n        uses: JamesIves/github-pages-deploy-action@3.6.1\n        with:\n          GITHUB_TOKEN: ${{ secrets.ACCESS_TOKEN }}\n          BRANCH: gh-pages\n          FOLDER: out\n          CLEAN: true\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eOn each push to the \u003ccode\u003emain\u003c/code\u003e branch the action runs \u003ccode\u003enpm run build\u003c/code\u003e and pushes the folder \u003ccode\u003eout\u003c/code\u003e to\nthe \u003ccode\u003egh-pages\u003c/code\u003e branch using our token \u003ccode\u003esecrets.ACCESS_TOKEN\u003c/code\u003e.\u003c/p\u003e\n\u003ch2\u003eEnable GitHub Pages\u003c/h2\u003e\n\u003cp\u003eMake shure that GitHub Pages is active in your repository. In your repository go to \u003cem\u003eSettings\u003c/em\u003e -\u003e\n\u003cem\u003ePages\u003c/em\u003e and \u003ccode\u003egh-pages\u003c/code\u003e is the source for the page.\u003c/p\u003e\n\u003cp\u003eBecause GitHub uses \u003cstrong\u003eJekyll\u003c/strong\u003e under the hood to host and render sites, this could create some problems. To disable Jekyll, create an empty file in the \u003ccode\u003egh-pages\u003c/code\u003e branch called \u003ccode\u003e.nojekyll\u003c/code\u003e.\nBecause of the \u003ccode\u003eCLEAN\u003c/code\u003e property our GitHub Action, this file will not be deleted.\u003c/p\u003e\n\u003ch2\u003eUpdate root level in Next.js\u003c/h2\u003e\n\u003cp\u003eNext.js assumes that the site is under the root level of your domain. But with GitHub Pages it will\nbe served under \u003ccode\u003eusername.github.io/repository\u003c/code\u003e.\u003c/p\u003e\n\u003cp\u003eWe can change the base path in \u003ccode\u003enext.config.js\u003c/code\u003e depending if we're developing locally or building\nfor production:\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003econst basePath = process.env.NODE_ENV === 'production' ? '/repo' : '';\n\nmodule.exports = {\n  basePath,\n  assetPrefix: `${basePath}/`\n};\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003ccode\u003ebasePath\u003c/code\u003e specifies the root for \u003ccode\u003e\u0026#x3C;Link\u003e\u003c/code\u003e components, \u003ccode\u003eassetPrefix\u003c/code\u003e the root for all assets.\u003c/p\u003e\n\u003ch2\u003eTroubleshooting\u003c/h2\u003e\n\u003cp\u003eI get an error during the build process stating that the command \u003ccode\u003e::set-env name=DEPLOYMENT_STATUS::success\u003c/code\u003e can't be run. It seems to work nevertheless, but I'll give an update\nas soon as I've fixed the issue.\u003c/p\u003e\n","title":"Hosting a static Next.js site on GitHub Pages","date":"2021-04-16"}},"__N_SSG":true},"page":"/posts/[id]","query":{"id":"nextjs-static-site-on-gh-pages"},"buildId":"nQrL3V57bj8LmWSwcSGtq","assetPrefix":"/lambert.codes-Website","isFallback":false,"gsp":true}</script><script nomodule="" src="/lambert.codes-Website/_next/static/chunks/polyfills-8f31809deb7932dd0187.js"></script><script src="/lambert.codes-Website/_next/static/chunks/webpack-50bee04d1dc61f8adf5b.js" async=""></script><script src="/lambert.codes-Website/_next/static/chunks/framework.0a9f20eff0752717cd72.js" async=""></script><script src="/lambert.codes-Website/_next/static/chunks/commons.ee65f231e79a9a0fddaf.js" async=""></script><script src="/lambert.codes-Website/_next/static/chunks/main-5dfe3e88bbc030d62d41.js" async=""></script><script src="/lambert.codes-Website/_next/static/chunks/pages/_app-bf675666c14c1a780ca1.js" async=""></script><script src="/lambert.codes-Website/_next/static/chunks/7989c093b81d86ddb0abfb342d5bc2e84730435d.12ba32d70d70a300b14f.js" async=""></script><script src="/lambert.codes-Website/_next/static/chunks/pages/posts/%5Bid%5D-d2fc321675bd0eea2cef.js" async=""></script><script src="/lambert.codes-Website/_next/static/nQrL3V57bj8LmWSwcSGtq/_buildManifest.js" async=""></script><script src="/lambert.codes-Website/_next/static/nQrL3V57bj8LmWSwcSGtq/_ssgManifest.js" async=""></script></body></html>