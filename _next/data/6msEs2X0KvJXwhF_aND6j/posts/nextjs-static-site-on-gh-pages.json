{"pageProps":{"postData":{"id":"nextjs-static-site-on-gh-pages","contentHtml":"<p>Instead of using Vercel or Netlify I wanted to try out hosting my site on GitHub Pages.\nSince it's a fully static site right now (it only uses <code>gitStaticProps</code> and <code>getStaticPaths</code>)\nthis should be possible.</p>\n<p>While following this <a href=\"https://blog.sallai.me/deploy-next-site-to-github-pages\">great article</a> by József Sallai I got it up and running with just a few steps:</p>\n<h2>Updating the build script</h2>\n<p>Change the <strong>build script</strong> in your <code>package.json</code> file to</p>\n<pre><code>\"scripts\": {\n  \"build\": \"next build &#x26;&#x26; next export\"\n}\n</code></pre>\n<p>The output told me that <code>next export</code> isn't necessary. I didn't test it yet, but maybe <code>next build</code>\nis all that is needed.</p>\n<p>The build command creates the folders <code>.next</code> and <code>out</code>. You don't have to commit these folders to\nthe main branch because we want a GitHub Action to build and commit these folders automatically to\na <code>gh-pages</code> branch.</p>\n<p>Add these folders to the <code>.gitignore</code> if you created these folders on your local machine.</p>\n<h2>Setting up the GitHub Action</h2>\n<p>The first step is to generate a <strong>personal access token</strong> for the action to be able to commit and push.</p>\n<p>Go to <em>GitHub Settings</em> -> <em>Developer settings</em> -> <em>Personal access tokens</em> and generate a new token\nwith <strong>repo</strong> scope.</p>\n<p>With this token go to the repository and under <em>Settings</em> -> <em>Secrets</em> create a new secret named\n<code>ACCESS_TOKEN</code>.</p>\n<p>To create a GitHub Action you need a directory in your repository called <code>.github/workflows</code>. In\nthat folder create a <code>.yaml</code> file with the following contents:</p>\n<pre><code>name: Build and Deploy\non:\n  push:\n    branches:\n      - main\njobs:\n  build-and-deploy:\n    runs-on: ubuntu-latest\n    steps:\n      - name: Checkout\n        uses: actions/checkout@v2.3.1\n        with:\n          persist-credentials: false\n\n      - name: Build\n        run: |\n          npm ci\n          npm run build\n\n      - name: Deploy to GitHub Pages\n        uses: Cecilapp/GitHub-Pages-deploy@v3\n        env:\n          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}\n        with:\n          email: username@domain.tld\n          build_dir: out\n          branch: gh-pages\n          cname: websitedomain.tld # optional\n          jekyll: no\n</code></pre>\n<p>On each push to the <code>main</code> branch the action runs <code>npm run build</code> and pushes the folder <code>out</code> to\nthe <code>gh-pages</code> branch using our token <code>secrets.ACCESS_TOKEN</code>.</p>\n<h2>Enable GitHub Pages</h2>\n<p>Make shure that GitHub Pages is active in your repository. In your repository go to <em>Settings</em> ->\n<em>Pages</em> and <code>gh-pages</code> is the source for the page.</p>\n<p>Because GitHub uses <strong>Jekyll</strong> under the hood to host and render sites, this could create some problems. To disable Jekyll, create an empty file in the <code>gh-pages</code> branch called <code>.nojekyll</code>.\nBecause of the <code>CLEAN</code> property our GitHub Action, this file will not be deleted.</p>\n<h2>Update root level in Next.js</h2>\n<p>Next.js assumes that the site is under the root level of your domain. But with GitHub Pages it will\nbe served under <code>username.github.io/repository</code>. If you <strong>don't</strong> have a custom domain, this will become a problem.</p>\n<p>We can change the base path in <code>next.config.js</code> depending if we're developing locally or building\nfor production:</p>\n<pre><code>const basePath = process.env.NODE_ENV === 'production' ? '/repository' : '';\n\nmodule.exports = {\n  basePath,\n  assetPrefix: `${basePath}/`\n};\n</code></pre>\n<p><code>basePath</code> specifies the root for <code>&#x3C;Link></code> components, <code>assetPrefix</code> the root for all assets.</p>\n<h2>Conclusion</h2>\n<p>I didn't think it was too bad setting things up. This was the first time I took the time to configure GitHub Actions and it felt straightforward to me. Józsefs Article really helped a lot and saved me from some serious headaches!</p>\n","title":"Hosting a static Next.js site on GitHub Pages","date":"2021-04-16"}},"__N_SSG":true}